<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="google-adsense-account" content="ca-pub-3163843239830061">
  <title>Tabela FIPE - Busca</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --muted: #6b7280;
      --primary: #0b69ff;
      --accent: #06b6d4;
      --text: #0f172a;
      --shadow: 0 6px 20px rgba(2, 6, 23, 0.08);
      --radius: 10px;
      --gap: 14px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      font-family: Inter, "Segoe UI", Roboto, Arial, Helvetica, sans-serif;
      margin: 24px;
      background: linear-gradient(180deg, var(--bg), #eef2ff 60%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
    }

    /* artigo principal */
    body>div:first-child {
      max-width: 1100px;
      width: 100%;
      background: transparent;
      padding: 0;
    }

    article {
      background: var(--card);
      padding: 22px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin: 0 auto;
      max-width: 1100px;
      line-height: 1.6;
    }

    article h1 {
      margin: 0 0 10px;
      font-size: 1.6rem;
      color: var(--text);
    }

    article h2 {
      margin-top: 18px;
      font-size: 1.05rem;
      color: var(--primary);
    }

    article p,
    article li {
      color: #1f2937;
      font-size: 0.98rem
    }

    .card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      transition: transform .18s ease;
    }

    .card:hover {
      transform: translateY(-3px)
    }

    label {
      display: block;
      margin: 10px 0 6px;
      font-weight: 600;
      color: #0b1220;
      font-size: 0.95rem;
    }

    select,
    button {
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #e6e9ef;
      background: #fff;
      transition: box-shadow .12s, border-color .12s;
      outline: none;
    }

    select:focus,
    button:focus {
      box-shadow: 0 6px 18px rgba(11, 105, 255, 0.08);
      border-color: rgba(11, 105, 255, 0.22)
    }

    select {
      width: 100%;
      appearance: none;
      -webkit-appearance: none;
      cursor: pointer
    }

    .row {
      display: flex;
      gap: var(--gap);
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .col {
      flex: 1;
      min-width: 160px;
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    button[disabled] {
      background: #e6eefc;
      color: #9fb4ff;
      cursor: not-allowed;
      box-shadow: none;
      border: 1px solid #e6eefc;
    }

    pre {
      background: #0b1220;
      color: #dff3e6;
      text-align: left;
      padding: 12px;
      border-radius: 8px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      font-size: 13px;
      max-height: 300px;
    }

    .muted {
      color: var(--muted);
      font-size: 14px
    }

    #resultado {
      margin-top: 6px;
    }

    /* status com "spinner" via CSS quando houver texto */
    #spinner {
      display: inline-block;
      color: var(--muted);
      font-size: 13px;
      vertical-align: middle;
      margin-left: 8px;
    }

    #spinner:not(:empty)::before {
      content: '';
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 8px;
      border-radius: 50%;
      border: 2px solid rgba(11, 105, 255, 0.18);
      border-top-color: var(--primary);
      animation: spin .9s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    hr {
      border: none;
      border-top: 1px solid #eef2f7;
      margin: 18px 0
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      color: #0b1220;
      margin-bottom: 8px
    }

    details pre {
      margin-top: 8px
    }

    /* responsividade */
    @media (min-width:1024px) {
      body {
        padding: 36px
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 22px;
        align-items: start;
        width: 100%;
        max-width: 1200px;
      }

      article {
        padding: 28px
      }

      .card {
        padding: 22px
      }
    }

    @media screen and (max-width: 768px) {
      .modeloSelect {
        width: 100%;
      }

      .row {
        gap: 10px
      }

      .col {
        min-width: 120px
      }
    }
  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3163843239830061"
    crossorigin="anonymous"></script>
</head>

<body>
  <div>
    <article>
      <h1>Tabela FIPE: o que é e por que importa</h1>

      <p>Quando você compra ou vende um veículo, a Tabela FIPE é uma das referências mais usadas no Brasil. Ela
        apresenta preços médios praticados no mercado para carros, motos e caminhões e é atualizada mensalmente pela
        Fundação Instituto de Pesquisas Econômicas (FIPE).</p>

      <h2>O que é a Tabela FIPE?</h2>
      <p>É um referencial de preços médios utilizado por compradores, vendedores, seguradoras e órgãos públicos para
        avaliar o valor de veículos no mercado. Serve como base para negociações, cálculo de seguros e tributos.</p>

      <h2>Como a Tabela FIPE é calculada?</h2>
      <p>A FIPE considera diversos fatores para obter o valor médio de cada modelo, entre eles:</p>
      <ul>
        <li><strong>Ano de fabricação:</strong> modelos mais novos costumam valer mais;</li>
        <li><strong>Marca e modelo:</strong> marcas e modelos mais demandados impactam o preço;</li>
        <li><strong>Estado médio de conservação:</strong> a tabela reflete a média do mercado;</li>
        <li><strong>Oferta e demanda:</strong> disponibilidade influencia o valor médio.</li>
      </ul>

      <h2>Impacto no preço do veículo</h2>
      <p>A Tabela FIPE influencia diretamente:</p>
      <ul>
        <li><strong>Compra e venda:</strong> serve como referência para negociar um preço justo;</li>
        <li><strong>Seguro:</strong> seguradoras utilizam a tabela para calcular indenizações;</li>
        <li><strong>IPVA e licenciamento:</strong> valores podem ser baseados na cotação FIPE.</li>
      </ul>

      <h2>Por que consultar a FIPE?</h2>
      <p>Ela oferece transparência e segurança nas negociações, ajudando a evitar preços fora do mercado e servindo como
        referência jurídica em disputas.</p>

      <h2>Conclusão</h2>
      <p>Consultar a Tabela FIPE antes de comprar, vender ou segurar um veículo garante uma negociação mais justa e
        informada, com base em uma referência amplamente aceita no mercado brasileiro.</p>

        <br>
        <p class="muted">Agora que você sabe como consultar os valores dos veículos, consulte o quanto de juros você pagaria em um financiamento. <a href="financiamento_comentado.php">Simule um financiamento</a>.</p>
    </article>
      
  </div>
  <div class="card">
    <h2>Tabela FIPE — Busca de veículo</h2>
    <p class="muted">Selecione o tipo, marca, modelo e ano para ver os dados FIPE.</p>

    <label for="tipo">Tipo de veículo</label>
    <select id="tipo">
      <option value="">-- selecione --</option>
      <option value="cars">Carros</option>
      <option value="motorcycles">Motos</option>
      <option value="trucks">Caminhões</option>
    </select>

    <div class="row" style="margin-top:12px">
      <div class="col">
        <label for="marca">Marca</label>
        <select id="marca" disabled>
          <option value="">-- primeiro selecione o tipo --</option>
        </select>
      </div>
      <div class="col">
        <label for="modelo">Modelo</label>
        <select id="modelo" disabled>
          <option value="">-- selecione a marca --</option>
        </select>
      </div>
      <div class="col">
        <label for="ano">Ano / Código</label>
        <select id="ano" disabled class="modeloSelect">
          <option value="">-- selecione o modelo --</option>
        </select>
      </div>
    </div>

    <div style="margin-top:14px">
      <button id="buscar" disabled>Buscar dados FIPE</button>
      <span id="spinner" class="muted" style="margin-left:12px"></span>
      <span id="status" class="muted" style="margin-left:12px"></span>

    </div>

    <hr style="margin:18px 0">

    <h3>Resultado</h3>
    <div id="resultado">
      <p class="muted">Os dados aparecerão aqui após a busca.</p>
    </div>
  </div>

  <script>
    const tipoEl = document.getElementById('tipo');
    const marcaEl = document.getElementById('marca');
    const modeloEl = document.getElementById('modelo');
    const anoEl = document.getElementById('ano');
    const buscarBtn = document.getElementById('buscar');
    const resultadoEl = document.getElementById('resultado');
    const statusEl = document.getElementById('status');
    const spinner = document.getElementById('spinner')

    const API_BASE = 'https://fipe.parallelum.com.br/api/v2';

    function setStatus(text) { statusEl.textContent = text || '' }
    function setSpinner(text) { spinner.textContent = text || '' }


    tipoEl.addEventListener('change', async () => {
      clearSelect(marcaEl, '-- carregando marcas --');
      clearSelect(modeloEl, '-- selecione a marca --', true);
      clearSelect(anoEl, '-- selecione o modelo --', true);
      buscarBtn.disabled = true;

      const tipo = tipoEl.value;
      if (!tipo) { setStatus(''); marcaEl.disabled = true; return }

      try {
        setSpinner(' ');
        setStatus('Buscando marcas...');

        const res = await fetch(`${API_BASE}/${tipo}/brands`);
        if (!res.ok) throw new Error('Erro ao buscar marcas');
        const data = await res.json();

        populateSelect(marcaEl, data, 'Selecione a marca');
        marcaEl.disabled = false;
        setStatus('Marcas carregadas');
        setSpinner('')
      } catch (err) {
        setStatus('Erro ao carregar marcas');
        marcaEl.disabled = true;
        console.error(err);
        resultadoEl.innerHTML = `<pre>${err}</pre>`;
      }
    });

    marcaEl.addEventListener('change', async () => {
      clearSelect(modeloEl, '-- carregando modelos --');
      clearSelect(anoEl, '-- selecione o modelo --', true);
      buscarBtn.disabled = true;

      const tipo = tipoEl.value;
      const marcaId = marcaEl.value;
      if (!marcaId) { modeloEl.disabled = true; return }

      try {
        setSpinner(' ');
        setStatus('Buscando modelos...');

        const res = await fetch(`${API_BASE}/${tipo}/brands/${marcaId}/models`);
        if (!res.ok) throw new Error('Erro ao buscar modelos');
        const data = await res.json();

        // a resposta pode ser {models:[...]} ou um array direto
        const models = data.models || data;
        populateSelect(modeloEl, models, 'Selecione o modelo');
        modeloEl.disabled = false;
        setStatus('Modelos carregados')
        setSpinner('');
      } catch (err) {
        setStatus('Erro ao carregar modelos');
        modeloEl.disabled = true;
        console.error(err);
        resultadoEl.innerHTML = `<pre>${err}</pre>`;
      }
    });

    modeloEl.addEventListener('change', async () => {
      clearSelect(anoEl, '-- carregando anos --');
      buscarBtn.disabled = true;

      const tipo = tipoEl.value;
      const marcaId = marcaEl.value;
      const modeloId = modeloEl.value;
      if (!modeloId) { anoEl.disabled = true; return }

      try {
        setSpinner(' ');
        setStatus('Buscando anos...');

        const res = await fetch(`${API_BASE}/${tipo}/brands/${marcaId}/models/${modeloId}/years`);
        if (!res.ok) throw new Error('Erro ao buscar anos');
        const data = await res.json();

        // resposta é um array de {id,name}
        populateSelect(anoEl, data, 'Selecione o ano', true);
        anoEl.disabled = false;
        buscarBtn.disabled = false;
        setStatus('Anos carregados');
        setSpinner('');
      } catch (err) {
        setStatus('Erro ao carregar anos');
        anoEl.disabled = true;
        console.error(err);
        resultadoEl.innerHTML = `<pre>${err}</pre>`;
      }
    });

    buscarBtn.addEventListener('click', async () => {
      const tipo = tipoEl.value;
      const marcaId = marcaEl.value;
      const modeloId = modeloEl.value;
      const anoId = anoEl.value; // ex: "2016-1"
      if (!tipo || !marcaId || !modeloId || !anoId) return alert('Selecione todos os campos');

      try {
        setSpinner(' ');
        setStatus('Buscando dados do veículo...');
        const res = await fetch(`${API_BASE}/${tipo}/brands/${marcaId}/models/${modeloId}/years/${encodeURIComponent(anoId)}`);
        if (!res.ok) throw new Error('Erro ao buscar dados do veículo');
        const data = await res.json();

        renderResult(data, tipo);
        setSpinner('');
        setStatus('Dados carregados');
      } catch (err) {
        setStatus('Erro ao buscar dados');
        console.error(err);
        resultadoEl.innerHTML = `<pre>${err}</pre>`;
      }
    });

    function clearSelect(el, placeholder = '--', disable = false) {
      el.innerHTML = '';
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = placeholder;
      el.appendChild(opt);
      el.disabled = !!disable;
    }

    function populateSelect(el, items, firstLabel = '-- selecione --', useIdName = false) {
      el.innerHTML = '';
      const opt0 = document.createElement('option');
      opt0.value = '';
      opt0.textContent = `-- ${firstLabel} --`;
      el.appendChild(opt0);

      items.forEach(item => {
        const option = document.createElement('option');
        // item pode ser string ou objeto com várias chaves (id, code, codigo, name, nome)
        if (typeof item === 'string') {
          option.value = item;
          option.textContent = item;
        } else if (item && typeof item === 'object') {
          // Priorizar chaves comuns da API FIPE v2: 'code' e 'name'
          const id = item.id ?? item.ID ?? item.code ?? item.Code ?? item.codigo ?? item.Codigo ?? item.value ?? item.key;
          const name = item.name ?? item.nome ?? item.label ?? item.title ?? item.Name ?? item.Label ?? item.nome;
          option.value = id ?? name ?? '';
          option.textContent = name ?? id ?? '';
        }
        el.appendChild(option);
      });
    }

    function renderResult(data, tipo) {
      // mostra JSON formatado e um resumo amigável
      const pretty = JSON.stringify(data, null, 2);
      let html = `<pre>${escapeHtml(pretty)}</pre>`;

      // campos principais se existirem
      const fields = ['price', 'brand', 'model', 'modelYear', 'fuel', 'codeFipe', 'referenceMonth', 'fuelAcronym'];
      const present = fields.filter(f => data[f] !== undefined);
      if (present.length) {
        html = '<div style="margin-bottom:12px">';
        present.forEach(f => {
          html += `<div><strong>${f}:</strong> ${escapeHtml(String(data[f]))}</div>`;
        });
        html += '</div>' + `<details><summary>JSON bruto</summary><pre>${escapeHtml(pretty)}</pre></details>`;
      }

      resultadoEl.innerHTML = html;
    }

    function escapeHtml(str) {
      return str.replace(/[&<>\"]+/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' })[c] || c);
    }
  </script>
  
</body>

</html>